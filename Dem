#!/bin/bash

# Define Nexus and GCP Artifact Registry credentials and repositories
NEXUS_URL="https://nexus.example.com/repository/docker-repo"
GCP_PROJECT_ID="your-gcp-project"
GCP_ARTIFACT_REPO="gcr.io"
GCP_REGION="your-region"
NEXUS_USER="your-nexus-username"
NEXUS_PASSWORD="your-nexus-password"

# Define images and tags
images=("cbflow-agent:10.6" "cbflow-web:12.1" "tool-box:5.0" "image4:tag" "image5:tag" "image6:tag")

# Authenticate with GCP (assumes you have gcloud installed and authenticated)
gcloud auth configure-docker ${GCP_REGION}-${GCP_ARTIFACT_REPO}

# Loop through the images and process each
for image in "${images[@]}"; do
    echo "Processing image: ${image}"

    # Check if the image contains specific keywords and assign the common path
    if [[ "$image" == *"cbflow-agent"* || "$image" == *"cbflow-web"* ]]; then
        echo "Using path com/hsbc for image: ${image}"
        nexus_path="com/hsbc"
    elif [[ "$image" == *"tool-box"* ]]; then
        echo "Using path com/hello for image: ${image}"
        nexus_path="com/hello"
    else
        echo "Using default path for image: ${image}"
        nexus_path="default"
    fi

    # Pull image from Nexus with the special path
    docker login -u ${NEXUS_USER} -p ${NEXUS_PASSWORD} ${NEXUS_URL}
    docker pull ${NEXUS_URL}/${nexus_path}/${image}

    # Tag image for Google Cloud Artifact Registry
    docker tag ${NEXUS_URL}/${nexus_path}/${image} ${GCP_REGION}-${GCP_ARTIFACT_REPO}/${GCP_PROJECT_ID}/${image}

    # Push image to Google Cloud Artifact Registry
    docker push ${GCP_REGION}-${GCP_ARTIFACT_REPO}/${GCP_PROJECT_ID}/${image}

    echo "Successfully pushed ${image} to GCP Artifact Registry"
done

echo "All images processed successfully!"
